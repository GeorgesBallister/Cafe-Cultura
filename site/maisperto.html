<!DOCTYPE html>
<html>

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Café Cultura</title>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" />
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js"></script>
  <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js"></script>
  <link rel="stylesheet" href="../src/style.css" />
</head>

<body>
  <header>
    <div class="header">
      <div class="logo-img">
        <img src="../Images/logo-cafe.webp" alt="Logo do Café Cultura">
        <!--<h1>Café <span style="color:#D2A754">Cultura</span></h1>
        <img src="./Images/Coffee cupXicrinha-Icone.png" alt="Logo-Titulo">-->
      </div>

    </div>  
  </header>

  <ul id="locations" class="locations"></ul>







  <!--Fotter da Pagina-->
  </main>
  <div class="footer">
    <a href="../index.html" style="text-decoration: none; cursor: pointer" class="footer-icon">
      <i class="fas fa-home"></i>
      <div class="footer-icon-text">Home</div>
    </a>
    <a href="./maisperto.html" style="text-decoration: none; cursor: pointer" class="footer-icon active">
      <i class="fas fa-map-marker-alt"></i>
      <div class="footer-icon-text active">Mais perto de você</div>
    </a>
    <a href="./perfilcaf.html" style="text-decoration: none; cursor: pointer" class="footer-icon   ">
      <i class="fas fa-mug-hot"></i>
      <div class="footer-icon-text ">Perfil cafeteria</div>
    </a>
  </div>
  <!--<footer>
        <nav class="footer-menu">
            <ul>
                <li><i class="fas fa-home"></i><a href="#">Início</a></li>
                <li><i class="fas fa-map-marker-alt"></i><a href="#">Mais perto de você</a></li>
                <li><i class="fas fa-mug-hot"></i><a href="#">Perfil Cafeteria</a></li>
            </ul>
        </nav>
    </footer> -->
  <script>
    // Get user's location
    navigator.geolocation.getCurrentPosition(
      (position) => {
        const userLatitude = position.coords.latitude;
        const userLongitude = position.coords.longitude;

        // Locations data
        const locations = [
          {
            "nome": "Castigliani Cafés",
            "latitude": -8.0307312,
            "longitude": -34.9123948,
            "links": "../site/perfis/castigliani.html"
          },
          {
            "nome": "Sao Braz Coffee",
            "latitude": -8.1145401,
            "longitude": -34.9660875,
            "links": "../site/perfis/saobraz.html"
          },
          {
            "nome": "Delta Expresso",
            "latitude": -8.0459149,
            "longitude": -34.879045,
            "links": "../site/perfis/delta.html"
          },
          {
            "nome": "Café Jaqueira",
            "latitude": -8.0372909,
            "longitude": -34.9727561,
            "links": "../site/perfis/jaqueira.html"
          },
          {
            "nome": "Contém Café",
            "latitude": -8.05428,
            "longitude": -34.8313,
            "links": "../site/perfis/contem.html"
          },
          {
            "nome": "Com Dengo",
            "latitude": -8.0459149,
            "longitude": -34.879045,
            "links": "../site/perfis/comdengo.html"
          },
          {
            "nome": "D'Vino Caffé",
            "latitude": -8.1283502,
            "longitude": -34.9058329,
            "links": "../site/perfis/dvino.html"
          },
          {
            "nome": "Versado Café",
            "latitude": -8.0455031,
            "longitude": -34.9678869,
            "links": "../site/perfis/versado.html"
          },
          {
            "nome": "Tokyo's Cafe",
            "latitude": -8.0397002,
            "longitude": -34.9071831,
            "links": "../site/perfis/tokyos.html"
          },
          {
            "nome": "Galo Padeiro",
            "latitude": -8.053637,
            "longitude": -34.8840243,
            "links": "../site/perfis/galopadeiro.html"
          },
          {
            "nome": "Elã - Cafés",
            "latitude": -8.07428,
            "longitude": -34.8813,
            "links": "../site/perfis/ela.html"
          },
          {
            "nome": "Café - Tão",
            "latitude": -8.0379572,
            "longitude": -34.9399329,
            "links": "../site/perfis/cafetao.html"
          },
          {
            "nome": "Café mais Prosa",
            "latitude": -8.0436854,
            "longitude": -34.9343439,
            "links": "../site/perfis/maisprosa.html"
          },
          {
            "nome": "O Pátio Café & Cozinha",
            "latitude": -8.050822,
            "longitude": -34.9390384,
            "links": "../site/perfis/patio.html"
          },
          {
            "nome": "Lalá Café",
            "latitude": -8.05428,
            "longitude": -34.8813,
            "links": "../site/perfis/lalacafe.html"
          },
          {
            "nome": "Cafetteria Bistrô",
            "latitude": -8.0458442,
            "longitude": -34.9362298,
            "links": "../site/perfis/bistro.html"
          },
          {
            "nome": "Borsoi Café",
            "latitude": -8.1045232,
            "longitude": -34.9288053,
            "links": "../site/perfis/borsoi.html"
          },
          {
            "nome": "Harina Café",
            "latitude": -8.1065159,
            "longitude": -34.930122,
            "links": "../site/perfis/harina.html"
          },
          {
            "nome": "Café KM",
            "latitude": -8.1189434,
            "longitude": -34.9460273,
            "links": "../site/perfis/cafekm.html"
          },
          {
            "nome": "Delicatessen Morada Colonial",
            "latitude": -8.066751,
            "longitude": -34.9671232,
            "links": "../site/perfis/moradacolonial.html"
          },
          {
            "nome": "Silva Café",
            "latitude": -8.012428,
            "longitude": -34.8813,
            "links": "../site/perfis/silvacafe.html"
          },
          {
            "nome": "Santa Clara",
            "latitude": -8.0333015,
            "longitude": -34.9498723,
            "links": "../site/perfis/santaclara.html"
          }
        ];

        // Calculate distances and sort by nearest to furthest
        const sortedLocations = locations.sort((a, b) => {
          const distanceToA = getDistance(userLatitude, userLongitude, a.latitude, a.longitude);
          const distanceToB = getDistance(userLatitude, userLongitude, b.latitude, b.longitude);
          return distanceToA - distanceToB;
        });

        // Display sorted locations
        const locationsList = document.getElementById("locations");
        sortedLocations.forEach((location) => {
          const distance = getDistance(userLatitude, userLongitude, location.latitude, location.longitude);
          const li = document.createElement("li");
          const link = document.createElement('a');
          link.innerText = `${location.nome} - ${distance.toFixed(2)} km`;
          link.href = location.links;
          li.appendChild(link);
          locationsList.appendChild(li);
        });
        if (index >= 10) {
          return; // sai do loop após o 10º item
        }
        const listapesq = document.createElement('li');
        const link = document.createElement('a');
      
        link.innerText = item.nome;
        link.href = item.links;
        listapesq.appendChild(link);
        resultados.appendChild(listapesq);
      
        listapesq.addEventListener('click', function() {
          window.location.href = item.links;
        });
      },
      () => {
        console.log("Unable to retrieve your location.");
      }
    );

    // Calculate distance between two coordinates using Haversine formula
    function getDistance(lat1, lon1, lat2, lon2) {
      const earthRadius = 6371; // km
      const dLat = deg2rad(lat2 - lat1);
      const dLon = deg2rad(lon2 - lon1);
      const a =
        Math.sin(dLat / 2) * Math.sin(dLat / 2) +
        Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) *
        Math.sin(dLon / 2) * Math.sin(dLon / 2);
      const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1 - a));
      const distance = earthRadius * c;
      return distance;
    }

    function deg2rad(deg) {
      return deg * (Math.PI / 180);
    }
  </script>
</body>

</html>